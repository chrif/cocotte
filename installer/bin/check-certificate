#!/usr/bin/env php
<?php

function certIsValid($host)
{
    exec(
        "curl --cert-status --silent -S --stderr /dev/stdout https://$host",
        $out,
        $ret
    );

    if ($ret === 91) {
        return true;
    } else {
        fwrite(STDERR, implode("\n", $out));
        return false;
    }
}

$host = $argv[1];

for ($i = 0; $i < 12; $i++) {
    if (certIsValid($host)) {
        echo "SSL Certificate for $host is valid.\n";
        exit(0);
    } else {
        sleep(5);
    }
}

fwrite(STDERR, "\nError: SSL Certificate for $host is invalid.\n");
exit(1);
