#!/usr/bin/env php
<?php

function traefikIsReady()
{
    $httpStatus = exec(
        'curl -S --insecure --silent --output /dev/stderr --write-out "%{http_code}" ' .
        '--user "${TRAEFIK_UI_USERNAME}":"${TRAEFIK_UI_PASSWORD}" ' .
        'https://${TRAEFIK_UI_HOST}/ping',
        $out,
        $ret
    );

    return $ret === 0 && $httpStatus == 200;
}

for ($i = 0; $i < 12; $i++) {
    if (traefikIsReady()) {
        echo "\n";
        exit(0);
    } else {
        sleep(5);
    }
}

fwrite(STDERR, "\nError: timeout waiting for traefik.\n");
exit(1);
